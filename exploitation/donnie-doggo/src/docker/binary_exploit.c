//compiled with: gcc -m32 -fno-stack-protector binary_exploit.c -o binary_exploit

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

void dummy(const char* input, char* pass) {
    char buff[64];
    sprintf(buff, input);
    if (strcmp(buff, pass) == 0) {
        printf("ACCESS GRANTED - \"%s\" is a match!\n", buff);
    } else {
        printf("ACCESS DENIED - \"%s\" does not match your password.\n", buff);
    }
}

int main() {
    setvbuf(stdout, NULL, _IONBF, 0);
    char* ptr = getenv("FLAG");
    printf("Reading password from address: %p\n", ptr);
    char input[64];
    printf("Welcome, Donnie.\n");
    printf("Please enter your password: ");
    if (fgets(input, 64, stdin) == NULL) {
        fprintf(stderr, "ERR: failed to read password.\n");
        return 1;
    }
    input[strcspn(input, "\n")] = '\0';
    if (!strlen(input)) {
        fprintf(stderr, "ERR: password cannot be empty.\n");
        return 2;
    }
    dummy(input, ptr);
    return 0;
}